import numpy as np
from ParseStatic import parse_static
from ParseDynamic import parse_dynamic
import os
import pickle
import csv
import sys

main_folder = sys.argv[1]
static_files = []
dynamic_files = []
for r, d, f in os.walk(main_folder):
    for file in f:
        if(file==("Structure_Info.txt")):
            static_files.append(os.path.join(r, file))
        elif(file.endswith('.json')):
            dynamic_files.append(os.path.join(r,file))

md5_static, data_static, failed_md5_static = parse_static(static_files)
md5_dynamic, data_dynamic, failed_md5_dynamic = parse_dynamic(dynamic_files)

with open('static_model', 'rb') as f:
    rf_static = pickle.load(f)

with open('dynamic_model', 'rb') as f:
    rf_dynamic = pickle.load(f)

y_static = rf_static.predict(data_static)
y_dynamic = rf_dynamic.predict(data_dynamic)

with open('prediction.csv','w') as csvfile:
    spamwriter = csv.writer(csvfile, delimiter=',', quotechar='|', quoting=csv.QUOTE_MINIMAL)
    rows_static = list(zip(md5_static,y_static))
    rows_dynamic = list(zip(md5_dynamic,y_dynamic))
    spamwriter.writerows(rows_static)
    spamwriter.writerows(rows_dynamic)



